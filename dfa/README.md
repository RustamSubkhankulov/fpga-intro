### Построение детерменированного конечного автомата на основе описанного алгоритма
#### Задача
Cпроектировать и описать на языке Verilog ДКА, соответствутющий описанию ниже.

#### Описание
Вас уговорили спроектировать автомат с прохладительными напитками для офиса. Расходы на напитки частично покрывает профсоюз, поэтому они стоят всего по 5 рублей. Автомат принимает монеты в 1, 2 и 5 рублей. Как только покупатель внесет необходимую сумму, автомат выдаст напиток и сдаст сдачу. 

Спроектируйте конечный автомат для автомата с прохладительными напитками. 

Входами автомата являются 1, 2 и 5 рублей, а именно, какая из этих монет вставлена. Предположим, что по каждому тактовому сигналу вставляется только одна монета. 

Автомат имеет выходы: налить газировку, вернуть 1 рубль, вернуть 2 рубля, вернуть 2 по 2 рубля. 

Как только в автомате набирается 5 рублей (или больше), он выставляет сигнал «НАЛИТЬ ГАЗИРОВКУ», а также сигналы, возврата соответствующей сдачи. Затем автомат должен быть готов опять принимать монеты.

#### Граф ДКА Мура
![DFA Mura](https://github.com/RustamSubkhankulov/fpga-intro/blob/main/03_dfa/pictures/mur.png)
Закрашенный цвет состояния означает, что при нахождении в нем выполняется 'soda == 1'

#### Таблица истинности для автомата Мура

- S3,S2,S1,S0 - биты, кодирующие текущее состояние
- in1, in2, in5 - входные сигналы, соотвествующие внесению в автомат 1, 2 и 5 рулблей соответственно
- S3',S2',S1',S0' - биты, кодирующие следующее состояние
- out1, out2, out2x2 - биты, соотвествующие выдаче сдачи в 1, 2 и 2 по 2 рубля
- soda - сигнал выдачи газировки

| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 0  | 0  | 0  | none | 0   | 0   | 0   | 0   |
| 0  | 0  | 0  | 0  | in1  | 0   | 0   | 0   | 1   |
| 0  | 0  | 0  | 0  | in2  | 0   | 0   | 1   | 0   |
| 0  | 0  | 0  | 0  | in5  | 0   | 1   | 0   | 1   |

| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 0  | 0  | 1  | none | 0   | 0   | 0   | 1   |
| 0  | 0  | 0  | 1  | in1  | 0   | 0   | 1   | 0   |
| 0  | 0  | 0  | 1  | in2  | 0   | 0   | 1   | 1   |
| 0  | 0  | 0  | 1  | in5  | 0   | 1   | 1   | 0   |

| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 0  | 1  | 0  | none | 0   | 0   | 1   | 0   |
| 0  | 0  | 1  | 0  | in1  | 0   | 0   | 1   | 1   |
| 0  | 0  | 1  | 0  | in2  | 0   | 1   | 0   | 0   |
| 0  | 0  | 1  | 0  | in5  | 0   | 1   | 1   | 1   |

| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 0  | 1  | 1  | none | 0   | 0   | 1   | 1   |
| 0  | 0  | 1  | 1  | in1  | 0   | 1   | 0   | 0   |
| 0  | 0  | 1  | 1  | in2  | 0   | 1   | 0   | 1   |
| 0  | 0  | 1  | 1  | in5  | 1   | 0   | 0   | 0   |

| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 1  | 0  | 0  | none | 0   | 1   | 0   | 0   |
| 0  | 1  | 0  | 0  | in1  | 0   | 1   | 0   | 1   |
| 0  | 1  | 0  | 0  | in2  | 0   | 1   | 1   | 0   |
| 0  | 1  | 0  | 0  | in5  | 1   | 0   | 0   | 1   |


| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 1  | 0  | 1  | none | 0   | 1   | 0   | 1   |
| 0  | 1  | 0  | 1  | in1  | 0   | 0   | 0   | 1   |
| 0  | 1  | 0  | 1  | in2  | 0   | 0   | 1   | 0   |
| 0  | 1  | 0  | 1  | in5  | 0   | 1   | 0   | 1   |

| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 1  | 1  | 0  | none | 0   | 1   | 0   | 1   |
| 0  | 1  | 1  | 0  | in1  | 0   | 0   | 0   | 1   |
| 0  | 1  | 1  | 0  | in2  | 0   | 0   | 1   | 0   |
| 0  | 1  | 1  | 0  | in5  | 0   | 1   | 0   | 1   |


| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 0  | 1  | 1  | 1  | none | 0   | 1   | 0   | 1   |
| 0  | 1  | 1  | 1  | in1  | 0   | 0   | 0   | 1   |
| 0  | 1  | 1  | 1  | in2  | 0   | 0   | 1   | 0   |
| 0  | 1  | 1  | 1  | in5  | 0   | 1   | 0   | 1   |

| S3 | S2 | S1 | S0 | sig  | S3' | S2' | S1' | S0' |
|----|----|----|----|------|-----|-----|-----|-----|
| 1  | 0  | 0  | X  | none | 0   | 1   | 0   | 1   |
| 1  | 0  | 0  | X  | in1  | 0   | 0   | 0   | 1   |
| 1  | 0  | 0  | X  | in2  | 0   | 0   | 1   | 0   |
| 1  | 0  | 0  | X  | in5  | 0   | 1   | 0   | 1   |

Для простоты записи ввёдем обозначение 
none = ~in1 & ~in2 & ~in5

S0' = ((in1 | in5) & ~S3 & ~S2 & ~S0)
    | ((in1 | in5)  & ~S3 &  S2)
    | ((in1 | in5)  & S3)
    | (none & ~S3 & ~S2 &  S0)
    | (in2  & ~S3 & ~S2 &  S0)
    | (none & ~S3 &  S2 & ~S1 &  S0)
    | (none & ~S3 &  S2 &  S1)
    | (none & S3)

Аналогично строится и упрощается логическая формула для каждого бита из [S3',S2',S1',S0'].

soda = S3 | (S2 & (S1 | S0))
out1 = (S2 & S1 & ~S0) | (S3 & ~S0)
out2 = (S2 & S1 & S0) | (S3 & ~S0) 
out2x2 = S3 & S0

#### Граф ДКА Мили
![DFA Mili](https://github.com/RustamSubkhankulov/fpga-intro/blob/main/03_dfa/pictures/mili.png)
Синий цвет стрелки означает, что при данном переходе выполняется 'soda == 1'

#### Таблица истинности для автомата Мили

- S2,S1,S0 - биты, кодирующие текущее состояние 
- in1, in2, in5 - входные сигналы, соотвествующие внесению в автомат 1, 2 и 5 рулблей соответственно
- S2',S1',S0' - биты, кодирующие следующее состояние
- out1, out2, out2x2 - биты, соотвествующие выдаче сдачи в 1, 2 и 2 по 2 рубля
- soda - сигнал выдачи газировки

|    | S2 | S1 | S0 | in1 | in2 | in5 | S2' | S1' | S0' | out1 | out2 | out2x2 | soda |
|----|----|----|----|-----|-----|-----|-----|-----|-----|------|------|--------|------|
| S0 | 0  | 0  | 0  | 0   | 0   | 0   | 0   | 0   | 0   |      |      |        |      |
|    | 0  | 0  | 0  | 1   | 0   | 0   | 0   | 0   | 1   |      |      |        |      |
|    | 0  | 0  | 0  | 0   | 1   | 0   | 0   | 1   | 0   |      |      |        |      |
|    | 0  | 0  | 0  | 0   | 0   | 1   | 0   | 0   | 0   |      |      |        | 1    |

|    | S2 | S1 | S0 | in1 | in2 | in5 | S2' | S1' | S0' | out1 | out2 | out2x2 | soda |
|----|----|----|----|-----|-----|-----|-----|-----|-----|------|------|--------|------|
| S1 | 0  | 0  | 1  | 0   | 0   | 0   | 0   | 0   | 1   |      |      |        |      |
|    | 0  | 0  | 1  | 1   | 0   | 0   | 0   | 1   | 0   |      |      |        |      |
|    | 0  | 0  | 1  | 0   | 1   | 0   | 0   | 1   | 1   |      |      |        |      |
|    | 0  | 0  | 1  | 0   | 0   | 1   | 0   | 0   | 0   | 1    |      |        | 1    |

|    | S2 | S1 | S0 | in1 | in2 | in5 | S2' | S1' | S0' | out1 | out2 | out2x2 | soda |
|----|----|----|----|-----|-----|-----|-----|-----|-----|------|------|--------|------|
| S2 | 0  | 1  | 0  | 0   | 0   | 0   | 0   | 1   | 0   |      |      |        |      |
|    | 0  | 1  | 0  | 1   | 0   | 0   | 0   | 1   | 1   |      |      |        |      |
|    | 0  | 1  | 0  | 0   | 1   | 0   | 1   | 0   | 0   |      |      |        |      |
|    | 0  | 1  | 0  | 0   | 0   | 1   | 0   | 0   | 0   |      | 1    |        | 1    |

|    | S2 | S1 | S0 | in1 | in2 | in5 | S2' | S1' | S0' | out1 | out2 | out2x2 | soda |
|----|----|----|----|-----|-----|-----|-----|-----|-----|------|------|--------|------|
| S3 | 0  | 1  | 1  | 0   | 0   | 0   | 0   | 1   | 1   |      |      |        |      |
|    | 0  | 1  | 1  | 1   | 0   | 0   | 1   | 0   | 0   |      |      |        |      |
|    | 0  | 1  | 1  | 0   | 1   | 0   | 0   | 0   | 0   |      |      |        | 1    |
|    | 0  | 1  | 1  | 0   | 0   | 1   | 0   | 0   | 0   | 1    | 1    |        | 1    |

|    | S2 | S1 | S0 | in1 | in2 | in5 | S2' | S1' | S0' | out1 | out2 | out2x2 | soda |
|----|----|----|----|-----|-----|-----|-----|-----|-----|------|------|--------|------|
| S4 | 1  | 0  | 0  | 0   | 0   | 0   | 1   | 0   | 0   |      |      |        |      |
|    | 1  | 0  | 0  | 1   | 0   | 0   | 0   | 0   | 0   |      |      |        | 1    |
|    | 1  | 0  | 0  | 0   | 1   | 0   | 0   | 0   | 0   | 1    |      |        | 1    |
|    | 1  | 0  | 0  | 0   | 0   | 1   | 0   | 0   | 0   |      |      | 1      | 1    |

- out1 = S2 & in2 + S0 & in5
- out2 = S1 & in5
- out2x2 = S2 & in5

- soda = in5 + S2 & (in1 | in2) + S1 & S0 & in2

- S2' = S1 & ~S0 & in2 + S1 & S0 & in1 + S2 & ~in1 & ~in2 & ~in5
- S1' = ~S2 & ~S1 & in2 + ~S1 & S0 & in1 & ~in2 & ~in5 + S1 & ~S0 & ~in2 & ~in5 + S1 & S0 & ~in1 & ~in2 & ~in5
- S0' = ~S2 & ~S0 & in1 + ~S1 & S0 & ~in1 & ~in5 + S1 & S0 & ~in1 & ~in2 & ~in5
